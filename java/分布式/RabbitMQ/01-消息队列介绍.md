## 消息队列需求场景

> 在基于微服务开发的电商项目中，商品的查询和商品的修改是通过两个服务实现的，如果修改了商品的价格，如何保证商品查询服务查询出来的商品价格同步更新呢？

服务与服务之间的通信方式有两种：同步调用 和 异步消息调用

- 同步调用：远程过程调用，REST和RPC

- 异步消息调用：消息队列

  ![image](01-%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E4%BB%8B%E7%BB%8D.assets/BA48B8B92497416F991F0BDD6D9205DD)

1. 为了保证数据的一致性，当“商户商品修改服务”在完成对A库中商品信息的修改之后，需要调用“商户商品查询服务”及“自媒体商品查询服务”同步完成B库及C库中商品信息的修改；

2. 如果“商户商品修改服务”使用Ribbon或者Feign同步调用“商户商品查询服务”及“自媒体商品查询服务”虽然能够实现数据的同步修改，但是大大增加了“商户商品修改服务”对用户的响应时间

3. 为了缩短“商户商品修改服务”对用户的响应时间，我们可以在“商户商品修改服务”完成对A库修改之后，通过异步消息队列通知“商户商品查询服务”及“自媒体商品查询服务”。

   ![image](01-%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E4%BB%8B%E7%BB%8D.assets/032D1EF0A2F24D0D803A065BD0B4F9D0)

## 消息队列概念

- MQ全称为Message Queue,消息队列（MQ）是一种应用程序对应用程序的通信方法。应用程序通过读写出入队列的消息（针对应用程序的数据）来通信，而无需专用连接来链接它们。
- 消息传递指的是程序之间通过在消息中发送数据进行通信，而不是通过直接调用彼此来通信，直接调用通常是用于诸如远程过程调用的技术。排队指的是应用程序通过队列来通信。队列的使用除去了接收和发送应用程序同时执行的要求。

## 常见消息队列中间件

- RabbitMQ、ActiveMQ、RocketMQ、Kafka

  ![image](01-%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E4%BB%8B%E7%BB%8D.assets/CDCD3EB1E2F0441CAACD8367207F6060)

- RabbitMQ 稳定可靠,数据一致,支持多协议,有消息确认,基于erlang语言

- Kafka 高吞吐,高性能,快速持久化,无消息确认,无消息遗漏,可能会有有重复消息,依赖于zookeeper,成本高.

- ActiveMQ 不够灵活轻巧,对队列较多情况支持不好.

- RocketMQ 性能好,高吞吐,高可用性,支持大规模分布式，协议支持单一